<!DOCTYPE html>
<html>
  <head>
    <title>US National Parks vs Walmart Heatmap</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
  </head>
  <body>
    <div id="floating-panel">
      <button id="toggle-heatmap">Toggle National Parks</button>
      <button id="toggle-heatmap2">Toggle Walmart Stores</button>
    </div>
    <div id="map"></div>

    <script>
      let map, heatmap, heatmap2;
      let parks = [];
      let walmart = [];

      // Helper function to parse CSV text into objects
      function parseCSV(text) {
        const lines = text.trim().split("\n").slice(1);
        return lines.map(line => {
          const [lon, lat] = line.split(","); //format is lon,lat,name
          return { lat: parseFloat(lat), lon: parseFloat(lon) };
        });
      }

      // Initialize map after both CSVs are loaded
      async function initMap() {
        // Get both CSV files
        const parksResponse = await fetch("./data/nationalparks.csv");
        const walmartResponse = await fetch("./data/walmart.csv");

        const parksText = await parksResponse.text();
        const walmartText = await walmartResponse.text();

        // Parse CSV text into coordinate arrays
        parks = parseCSV(parksText);
        walmart = parseCSV(walmartText);

        // Import the Google Maps library
        const { Map } = await google.maps.importLibrary("maps");

        const center = { lat: 39.8283, lng: -98.5795 }; // geographic center of US

        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 4,
          center: center,
          mapId: "YOUR_MAP_ID",
        });

        // Create heatmaps using the loaded data
        heatmap = new google.maps.visualization.HeatmapLayer({
          data: parks.map(p => new google.maps.LatLng(p.lat, p.lon)),
          map: map,
          radius: 15,
        });

        heatmap2 = new google.maps.visualization.HeatmapLayer({
          data: walmart.map(p => new google.maps.LatLng(p.lat, p.lon)),
          map: map,
          radius: 15,
          gradient: [
            "rgba(0, 255, 255, 0)",
            "rgba(0, 255, 255, 1)",
            "rgba(0, 191, 255, 1)",
            "rgba(0, 127, 255, 1)",
            "rgba(0, 63, 255, 1)",
            "rgba(0, 0, 255, 1)",
            "rgba(255, 0, 0, 1)",
          ],
        });

        // Add buttons for toggle visibility
        document.getElementById("toggle-heatmap").addEventListener("click", () => {
          heatmap.setMap(heatmap.getMap() ? null : map);
        });
        document.getElementById("toggle-heatmap2").addEventListener("click", () => {
          heatmap2.setMap(heatmap2.getMap() ? null : map);
        });
      }
    </script>

    <script
      async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBuQLuUiOduUv-y5EVRtO9KzKFIEbWG83Y&loading=async&libraries=visualization&callback=initMap"
    ></script>
  </body>
</html>
